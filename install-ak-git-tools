#!/bin/sh

# install-ak-git-tools
#
# Copyright (c) 2014, Andrew Keller
#
# Copies the contents of the `bin` folder into the given prefix ($1).

prefix=$1

if [ -z "$prefix" ]
then
    echo "usage: `basename \"$0\"` <installation prefix>" >&2
    exit 1
fi

uninstaller=$prefix/bin/__uninstall-ak-git-tools

if [ -e "$uninstaller" ]
then
    "$uninstaller" "$prefix" || exit $?
fi

mkdir -p "$prefix/bin" || exit $?

echo '#!/bin/sh

# __uninstall-ak-git-tools
#
# Copyright (c) 2014, Andrew Keller
#
# Uninstalls ak-git-tools.  Requires the installation prefix as $1.
#
# This script is automatically generated by install-git-tools.  For more
# information, see:
#
#   <https://github.com/andrewkeller/ak-git-tools>

prefix=$1

if [ -z "$prefix" ]
then
    echo "usage: `basename \"$0\"` <installation prefix>" >&2
    exit 1
fi
' > "$uninstaller" || exit $?
chmod +x "$uninstaller"

for f in bin/*
do

    if cp "$f" "$prefix/bin/"
    then

        echo 'rm -f "$prefix/'$f'" || exit $?' >> "$uninstaller"

    else

        "$uninstaller" "$prefix"
        rm -f "$uninstaller"
        exit 1

    fi

done

echo 'rm -f "$prefix/bin/__uninstall-ak-git-tools" || exit $?' >> "$uninstaller"

echo "Installation successful." >&2
